<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Video Stream Player</title>
    <script src="https://content.jwplatform.com/libraries/SAHhwvZq.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        #jwplayerDiv {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        #loadingMessage {
            margin-top: 20px;
            font-size: 18px;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>Live Video Stream</h1>
    <div id="jwplayerDiv"></div>
    <div id="loadingMessage">Loading stream details...</div>

    <script>
        // Function to fetch stream details from server
        async function fetchStreamDetails() {
            try {
                const response = await fetch('/stream-details');
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const streamDetails = await response.json();
                
                // Setup JW Player with fetched details
                setupPlayer(streamDetails);
            } catch (error) {
                console.error('Error fetching stream details:', error);
                document.getElementById('loadingMessage').textContent = 'Failed to load stream. Please check the server.';
            }
        }

        // Function to setup JW Player
        function setupPlayer(streamDetails) {
            try {
                // Hide loading message
                document.getElementById('loadingMessage').style.display = 'none';

                // Setup JW Player with details from server
                jwplayer("jwplayerDiv").setup({
                    file: streamDetails.file || "",
                    type: "dash",
                    drm: {
                        "clearkey": {
                            "keyId": streamDetails.keyId || "",
                            "key": streamDetails.key || ""
                        }
                    },
                    width: "100%",
                    height: "500px"
                });
            } catch (error) {
                console.error('Error setting up player:', error);
                document.getElementById('loadingMessage').textContent = 'Failed to initialize player.';
            }
        }

        // Fetch stream details when page loads
        fetchStreamDetails();
    </script>
</body>
</html>
